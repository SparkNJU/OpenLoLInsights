基于我们之前的调试和 Schema 优化，你的 Agent 目前已经构建了一套非常强大的查询逻辑体系。

以下是当前 **Agent 可以稳定实现的 5 大类查询** 及其对应的能力总结：

### 1. 战队综合战绩查询 (Team General Stats)
**能力**：查询单支战队在特定年份、赛区或赛段的胜负场次、总场次及大场胜率。
*   **逻辑**：自动区分 Team1/Team2，统计 Winner，支持模糊匹配赛事名。
*   **举例**：
    *   `"GenG 25年的胜负场情况"` —— (默认查25年全年)
    *   `"IG 25年LPL春季赛战绩"` —— (自动映射为 '第一赛段')
    *   `"T1 24年世界赛的胜率"` —— (自动匹配 '24/s%')

### 2. 战队交手记录查询 (Head-to-Head)
**能力**：查询两支特定战队之间的历史交手胜率（H2H）。
**核心优化**：引入了双表关联（T_A, T_B）和防御性编程（忽略 S 赛 stage 字段防止漏查）。
*   **举例**：
    *   `"BLG和TES在25年的交手胜率"`
    *   `"23年S赛 T1 对阵 JDG 的结果"` —— (不依赖 stage 字段，直接查对阵)
    *   `"25年LPL夏季赛 BLG 打 TES 谁赢得多"` —— (自动映射夏季赛->第三赛段)

### 3. 选手深度数据查询 (Player Advanced Stats)
**能力**：跨越 4 张表（Players -> PlayerGameStats -> Games -> Matches）查询选手的累积数据或平均数据。
**核心优化**：包含 KDA 计算公式（含除零保护）、总击杀/助攻统计、场均数据。
*   **举例**：
    *   `"Faker 历届S赛的总击杀数"` —— (跨多年份聚合)
    *   `"Chovy 25年LCK夏季赛的场均击杀"` —— (自动映射赛段 + AVG计算)
    *   `"Bin 25年MSI的KDA是多少"` —— (特定赛事 KDA 计算)

### 4. 红蓝方胜率分析 (Side Selection Stats)
**能力**：基于小局（Game）维度，统计特定赛事中红方与蓝方的胜率差异。
**核心优化**：直接使用 `Games` 表的 `blue_team_id` 和 `red_team_id` 与 `winner_id` 对比，不再依赖大场顺序，结果精确。
*   **举例**：
    *   `"25年MSI红蓝方胜率情况"`
    *   `"24年LPL夏季赛定组赛 蓝色方胜率"` —— (精确到 '定组赛' stage)
    *   `"23年S赛淘汰赛红方胜率高吗"`

### 5. 复杂赛制与时间映射 (Complex Mapping)
**能力**：处理口语化的时间描述与数据库实际字段不一致的问题。
**核心优化**：
*   **2025 新赛制**：LPL (第一/二/三赛段)、LCK (LCK杯/第一/二赛段)。
*   **历史 S 赛**：兼容 "八强/半决/决赛" 与数据库中统称 "淘汰" 的矛盾。
*   **举例**：
    *   `"25年LPL夏季赛..."` -> 自动转 SQL `LIKE '%25/lpl/第三赛段%'`
    *   `"25年LCK春季赛..."` -> 自动转 SQL `LIKE '%25/lck/第一赛段%'`
    *   `"16年S赛半决赛..."` -> 自动处理为泛淘汰赛或通过对阵查找。

---

